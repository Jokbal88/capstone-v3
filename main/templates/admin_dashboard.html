{% extends 'mainv2.html' %}
{% load static tailwind_tags %}

{% block title %}HealthHub Connect | Admin Dashboard{% endblock %}

{% block extra_css %}
<style>
    html, body, #__next, main, .admin-dashboard-container {
        height: 100%;
        min-height: 100vh;
    }
    .admin-dashboard-container {
        width: 100%;
        min-height: 100vh;
        background: #fff;
        border-radius: 24px;
        box-shadow: 0 4px 24px 0 rgba(0,0,0,0.07);
        padding: 2.5rem 2.5rem 2.5rem 2.5rem;
        display: flex;
        flex-direction: column;
    }
    .dashboard-main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        flex: 1;
        height: 100%;
        align-items: stretch;
    }
    .dashboard-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px 0 rgba(0,0,0,0.04);
        padding: 1.5rem;
        margin-bottom: 0;
        height: 100%;
        display: flex;
        flex-direction: column;
        transition: box-shadow 0.2s;
    }
    .dashboard-card:hover {
        box-shadow: 0 4px 16px 0 rgba(59,130,246,0.10);
    }
    .dashboard-table th {
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.95rem;
        color: #374151;
        background: #f9fafb;
        letter-spacing: 0.04em;
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
    }
    .dashboard-table td {
        font-size: 1rem;
        color: #222;
        background: #fff;
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
    }
    .calendar-admin {
        width: 100%;
        max-width: 420px;
        height: 100%;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 2px 8px 0 rgba(0,0,0,0.08);
        padding: 1.5rem 1rem 1rem 1rem;
        border: 1.5px solid #e5e7eb;
    }
    .calendar-header-admin {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 2px;
        margin-bottom: 0.5rem;
    }
    .calendar-header-cell-admin {
        text-align: center;
        font-size: 1rem;
        font-weight: 700;
        color: #6B7280;
        padding: 0.5rem 0 0.25rem 0;
        letter-spacing: 0.04em;
    }
    #calendarDaysAdmin {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        grid-template-rows: repeat(6, 1fr);
        gap: 2px;
        flex: 1;
    }
    .calendar-day-admin {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        color: #374151;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        background: #f3f4f6;
        border: 1.5px solid #e5e7eb;
    }
    .calendar-day-admin:hover:not(.empty-day) {
        background: #e0e7ff;
        color: #1d4ed8;
        font-weight: 600;
    }
    .calendar-day-admin.today {
        background-color: #3B82F6;
        color: white;
        font-weight: 700;
        border: 2px solid #2563eb;
    }
    .calendar-day-admin.empty-day {
        cursor: default;
        color: #D1D5DB;
        background: #fff;
        border: 1.5px solid #fff;
    }
    @media (max-width: 1024px) {
        .dashboard-main-grid {
            grid-template-columns: 1fr;
        }
        .calendar-admin {
            max-width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="admin-dashboard-container">
    <!-- Stats Grid -->
    <div class="flex gap-4 mb-8 bg-gray-50 rounded-xl p-4 border border-gray-200">
        <div class="flex-1 dashboard-card flex flex-col items-center justify-center text-center shadow-none border-none bg-transparent hover:shadow-none">
            <i class="fas fa-users text-blue-500 text-xl mb-1"></i>
            <span class="text-xs text-gray-500 mb-1">Total Patients</span>
            <span class="text-2xl font-bold text-blue-600">{{ total_patients }}</span>
        </div>
        <div class="flex-1 dashboard-card flex flex-col items-center justify-center text-center shadow-none border-none bg-transparent hover:shadow-none">
            <i class="fas fa-file-medical text-green-500 text-xl mb-1"></i>
            <span class="text-xs text-gray-500 mb-1">Total Records</span>
            <span class="text-2xl font-bold text-green-600">{{ total_records|default:0 }}</span>
        </div>
        <div class="flex-1 dashboard-card flex flex-col items-center justify-center text-center shadow-none border-none bg-transparent hover:shadow-none">
            <i class="fas fa-clock text-yellow-500 text-xl mb-1"></i>
            <span class="text-xs text-gray-500 mb-1">Pending Requests</span>
            <span class="text-2xl font-bold text-yellow-600">{{ pending_requests|default:0 }}</span>
        </div>
        <div class="flex-1 dashboard-card flex flex-col items-center justify-center text-center shadow-none border-none bg-transparent hover:shadow-none">
            <i class="fas fa-calendar-check text-purple-500 text-xl mb-1"></i>
            <span class="text-xs text-gray-500 mb-1">Today's Schedule</span>
            <span class="text-2xl font-bold text-purple-600">{{ todays_schedule|default:0 }}</span>
        </div>
    </div>
    <div class="dashboard-main-grid">
        <!-- Left Column: Upcoming Requests -->
        <div class="flex flex-col h-full flex-1 gap-6">
            <div class="dashboard-card flex-1 flex flex-col">
                <h2 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2"><i class="fas fa-envelope-open-text text-blue-400"></i> Upcoming Requests</h2>
                <div class="overflow-x-auto flex-1">
                    <table class="min-w-full dashboard-table">
                        <thead>
                            <tr>
                                <th class="px-4 py-3">Student</th>
                                <th class="px-4 py-3">Request Type</th>
                                <th class="px-4 py-3">Date</th>
                                <th class="px-4 py-3">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for request in upcoming_requests %}
                            <tr class="hover:bg-blue-50 transition-colors">
                                <td class="px-4 py-3">{{ request.patient.user.get_full_name }}</td>
                                <td class="px-4 py-3">{{ request.request_type }}</td>
                                <td class="px-4 py-3">{{ request.date_requested|date:"M d, Y" }}</td>
                                <td class="px-4 py-3">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full
                                        {% if not request.approve %}bg-yellow-100 text-yellow-800
                                        {% else %}bg-green-100 text-green-800{% endif %}">
                                        {% if request.approve %}Approved{% else %}Pending{% endif %}
                                    </span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="px-4 py-8 text-center text-gray-400">No upcoming requests</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Right Column: Schedule (top) and Calendar (bottom) -->
        <div class="flex flex-col h-full flex-1 gap-6">
            <div class="dashboard-card flex-1 flex flex-col mb-0">
                <h2 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2"><i class="fas fa-calendar-alt text-blue-400"></i> Schedule</h2>
                <div class="space-y-3 flex-1">
                    {% for event in events %}
                    <div class="flex items-start space-x-3">
                        <div class="w-2 h-2 mt-2 bg-blue-500 rounded-full flex-shrink-0"></div>
                        <div>
                            <p class="text-sm font-semibold text-gray-800">{{ event.student }}</p>
                            <p class="text-xs text-gray-500">{{ event.service }} - {{ event.date }}</p>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-sm text-center text-gray-400">No scheduled events</p>
                    {% endfor %}
                </div>
            </div>
            <div class="calendar-admin w-full flex-1 flex flex-col justify-end">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-lg font-bold text-gray-800 flex items-center gap-2"><i class="fas fa-calendar-alt text-blue-400"></i> Calendar</span>
                    <div class="flex items-center space-x-4">
                        <button onclick="previousMonthAdmin()" class="text-gray-600 hover:text-gray-800">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span id="currentMonthAdmin" class="text-sm font-medium"></span>
                        <button onclick="nextMonthAdmin()" class="text-gray-600 hover:text-gray-800">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="calendar-header-admin">
                    <div class="calendar-header-cell-admin">Su</div>
                    <div class="calendar-header-cell-admin">Mo</div>
                    <div class="calendar-header-cell-admin">Tu</div>
                    <div class="calendar-header-cell-admin">We</div>
                    <div class="calendar-header-cell-admin">Th</div>
                    <div class="calendar-header-cell-admin">Fr</div>
                    <div class="calendar-header-cell-admin">Sa</div>
                </div>
                <div id="calendarDaysAdmin" class="flex-1"></div>
            </div>
        </div>
    </div>
</div>

<script>
let currentDateAdmin = new Date();
const monthNamesAdmin = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
];

function updateCalendarAdmin() {
    const calendar = document.getElementById('calendarDaysAdmin');
    const monthLabel = document.getElementById('currentMonthAdmin');
    calendar.innerHTML = '';
    monthLabel.textContent = `${monthNamesAdmin[currentDateAdmin.getMonth()]} ${currentDateAdmin.getFullYear()}`;
    const firstDay = new Date(currentDateAdmin.getFullYear(), currentDateAdmin.getMonth(), 1);
    const startingDay = firstDay.getDay();
    const lastDay = new Date(currentDateAdmin.getFullYear(), currentDateAdmin.getMonth() + 1, 0);
    const totalDays = lastDay.getDate();
    // Add empty cells for days before the first day of the month
    for (let i = 0; i < startingDay; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-day-admin empty-day';
        calendar.appendChild(emptyCell);
    }
    // Add the days of the month
    for (let day = 1; day <= totalDays; day++) {
        const cell = document.createElement('div');
        cell.className = 'calendar-day-admin';
        const today = new Date();
        if (
            day === today.getDate() &&
            currentDateAdmin.getMonth() === today.getMonth() &&
            currentDateAdmin.getFullYear() === today.getFullYear()
        ) {
            cell.className += ' today';
        }
        cell.textContent = day;
        calendar.appendChild(cell);
    }
    // Add empty cells for remaining days to complete the grid
    const remainingDays = 42 - (startingDay + totalDays); // 42 = 6 rows Ã— 7 days
    for (let i = 0; i < remainingDays; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-day-admin empty-day';
        calendar.appendChild(emptyCell);
    }
}
function previousMonthAdmin() {
    currentDateAdmin.setMonth(currentDateAdmin.getMonth() - 1);
    updateCalendarAdmin();
}
function nextMonthAdmin() {
    currentDateAdmin.setMonth(currentDateAdmin.getMonth() + 1);
    updateCalendarAdmin();
}
document.addEventListener('DOMContentLoaded', updateCalendarAdmin);
</script>
{% endblock %}
