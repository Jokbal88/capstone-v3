{% extends 'mainv2.html' %} 
{% load static tailwind_tags %} 

{% block title %}HealthHub Connect | Admin Dashboard{% endblock %}

{% block extra_css %} 
<style>
    html, body, #__next, main, .admin-dashboard-container {
        height: 100%;
        min-height: 100vh;
    }
    .admin-dashboard-container {
        width: 100vw;
        min-height: 100vh;
        background: #fff;
        border-radius: 0;
        box-shadow: none;
        padding: 0;
        display: flex;
        flex-direction: column;
    }
    .dashboard-main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        flex: 1;
        height: 100%;
        align-items: stretch;
    }
    .dashboard-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px 0 rgba(0,0,0,0.04);
        padding: 1.5rem;
        margin-bottom: 0;
        height: 100%;
        display: flex;
        flex-direction: column;
        transition: box-shadow 0.2s;
    }
    .dashboard-card:hover {
        box-shadow: 0 4px 16px 0 rgba(59,130,246,0.10);
    }
    .dashboard-table th {
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.95rem;
        color: #374151;
        background: #f9fafb;
        letter-spacing: 0.04em;
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
    }
    .dashboard-table td {
        font-size: 1rem;
        color: #222;
        background: #fff;
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
    }
    .calendar-admin {
        width: 100%;
        max-width: 100%;
        min-width: 0;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 1px 4px 0 rgba(0,0,0,0.06);
        padding: 0.5rem 0.5rem 0.5rem 0.5rem;
        border: 1px solid #e5e7eb;
        box-sizing: border-box;
    }
    .calendar-header-admin {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        margin-bottom: 0.2rem;
    }
    .calendar-header-cell-admin {
        text-align: center;
        font-size: 0.78rem;
        font-weight: 500;
        color: #6B7280;
        height: 28px;
        line-height: 28px;
        padding: 0;
        letter-spacing: 0.02em;
    }
    #calendarDaysAdmin {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        grid-template-rows: repeat(6, 1fr);
        gap: 1px;
        flex: 1;
    }
    .calendar-day-admin {
        min-width: 34px;
        min-height: 34px;
        max-width: 34px;
        max-height: 34px;
        font-size: 1rem;
        margin: 0 auto;
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        color: #374151;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        background: #f3f4f6;
        border: 1px solid #e5e7eb;
        position: relative;
    }
    .calendar-day-admin:hover:not(.empty-day) {
        background: #e0e7ff;
        color: #1d4ed8;
        font-weight: 600;
    }
    .calendar-day-admin.today {
        background-color: #3B82F6;
        color: white;
        font-weight: 700;
        border: 1.5px solid #2563eb;
    }
    .calendar-day-admin.empty-day {
        cursor: default;
        color: #D1D5DB;
        background: #fff;
        border: 1px solid #fff;
    }
    .calendar-day-admin.has-approved-event {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #34d399;
    }
    .calendar-day-admin.has-approved-event:hover {
        background: #a7f3d0;
        color: #065f46;
    }
    .calendar-day-admin.has-pending-event {
        background: #fef3c7;
        color: #92400e;
        border: 1px solid #fbbf24;
    }
    .calendar-day-admin.has-pending-event:hover {
        background: #fde68a;
        color: #92400e;
    }
    .calendar-day-admin.has-both-events {
        background: linear-gradient(135deg, #d1fae5 50%, #fef3c7 50%);
        color: #065f46;
        border: 1px solid #34d399;
    }
    .calendar-day-admin.has-both-events:hover {
        background: linear-gradient(135deg, #a7f3d0 50%, #fde68a 50%);
    }
    .calendar-day-admin.has-event::after {
        content: '';
        position: absolute;
        bottom: 2px;
        left: 50%;
        transform: translateX(-50%);
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: currentColor;
    }
    @media (max-width: 1024px) {
        .dashboard-main-grid {
            grid-template-columns: 1fr;
        }
        .calendar-admin {
            max-width: 100%;
        }
    }
</style>
{% endblock %} 

{% block content %}
<div class="flex flex-col bg-white rounded-[14px] h-min">
    <!-- Notifications Bar -->
    <div class="w-full flex items-center justify-between bg-yellow-50 border-b border-yellow-200 p-4 rounded-t-xl">
      <div class="flex items-center gap-2">
            <i class="fas fa-bell text-yellow-500 text-lg"></i>
            <span class="font-semibold text-yellow-800">Notifications</span>
            <span class="ml-2 bg-yellow-400 text-white rounded-full px-2 py-0.5 text-xs font-bold">{{ notifications|length }}</span>
      </div>
        <div class="flex gap-4 text-sm text-yellow-900">
            {% for note in notifications %}
                <span>{{ note }}</span>
            {% empty %}
                <span>No new notifications</span>
            {% endfor %}
      </div>
    </div>
    <div class="flex flex-col gap-4 h-auto p-4">
        <div class="flex flex-row gap-4 p-4 w-full">
            <div class="flex flex-col gap-2 basis-full">
                <span class="font-bold text-gray-700 mr-4"><i class="fas fa-bolt text-blue-400"></i> Quick Actions:</span>
                <div class="grid grid-cols-2 gap-2">
                    <a href="{% url 'main:register' %}" class="bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600 transition text-center">Add Patient</a>
                    <a href="{% url 'main:patient_form' %}" class="bg-green-500 text-white p-2 rounded-md hover:bg-green-600 transition text-center">Record Visit</a>
                    <a href="{% url 'medical:upload_requirements' %}" class="bg-purple-500 text-white p-2 rounded-md hover:bg-purple-600 transition text-center">Upload Document</a>
                    <a href="mailto:" class="bg-yellow-500 text-white p-2 rounded-md hover:bg-yellow-600 transition text-center">Send Notification</a>
                </div>
                <div class="flex flex-col justify-center items-center flex-[2] bg-white rounded-xl shadow border border-blue-100 ml-auto p-8 w-full">
                    <div id="adminLiveTime" class="text-5xl font-extrabold text-blue-700 mb-2 text-center"></div>
                    <div id="adminLiveDate" class="text-base font-semibold text-gray-600 text-center" ></div>
                </div>
            </div>
            <div class="calendar-admin w-full flex flex-col justify-end p-1">
                        <div class="flex items-center justify-between mb-2 w-full gap-2" style="margin-bottom: 1rem;">
                            <span class="text-base font-bold text-gray-800 flex items-center gap-2"><i class="fas fa-calendar-alt text-blue-400"></i> Calendar</span>
      <div class="flex items-center gap-2">
                                <button onclick="previousMonthAdmin()" class="text-gray-500 hover:text-blue-600 transition p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-200">
                <i class="fas fa-chevron-left"></i>
                </button>
                                <span id="currentMonthAdmin" class="px-4 py-1 bg-blue-50 text-blue-700 rounded-full font-semibold text-base shadow-sm border border-blue-100" style="min-width:120px; text-align:center;"></span>
                                <button onclick="nextMonthAdmin()" class="text-gray-500 hover:text-blue-600 transition p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-200">
                <i class="fas fa-chevron-right"></i>
                </button>
                        </div>
                        </div>
                        <div class="calendar-header-admin">
                            <div class="calendar-header-cell-admin">Sun</div>
                            <div class="calendar-header-cell-admin">Mon</div>
                            <div class="calendar-header-cell-admin">Tue</div>
                            <div class="calendar-header-cell-admin">Wed</div>
                            <div class="calendar-header-cell-admin">Thu</div>
                            <div class="calendar-header-cell-admin">Fri</div>
                            <div class="calendar-header-cell-admin">Sat</div>
                        </div>
                        <div id="calendarDaysAdmin" class="flex-1"></div>
            </div>
        </div>
        <div class="flex gap-4 bg-gray-50 rounded-xl p-4 border border-gray-200 items-stretch ">
            <div class="flex-1 dashboard-card flex flex-col items-center justify-center text-center shadow-none border-none bg-transparent hover:shadow-none">
                <i class="fas fa-users text-blue-500 text-xl mb-1"></i>
                <span class="text-xs text-gray-500 mb-1">Total Patients</span>
                <span class="text-2xl font-bold text-blue-600">{{ total_patients }}</span>
        </div>
            <div class="flex-1 dashboard-card flex flex-col items-center justify-center text-center shadow-none border-none bg-transparent hover:shadow-none">
                <i class="fas fa-file-medical text-green-500 text-xl mb-1"></i>
                <span class="text-xs text-gray-500 mb-1">Total Records</span>
                <span class="text-2xl font-bold text-green-600">{{ total_records|default:0 }}</span>
        </div>
            <div class="flex-1 dashboard-card flex flex-col items-center justify-center text-center shadow-none border-none bg-transparent hover:shadow-none">
                <i class="fas fa-clock text-yellow-500 text-xl mb-1"></i>
                <span class="text-xs text-gray-500 mb-1">Pending Requests</span>
                <span class="text-2xl font-bold text-yellow-600">{{ pending_requests|default:0 }}</span>
        </div>
            <div class="flex-1 dashboard-card flex flex-col items-center justify-center text-center shadow-none border-none bg-transparent hover:shadow-none">
                <i class="fas fa-calendar-check text-purple-500 text-xl mb-1"></i>
                <span class="text-xs text-gray-500 mb-1">Today's Schedule</span>
                <span class="text-2xl font-bold text-purple-600">{{ todays_schedule|default:0 }}</span>
        </div>
            <div class="flex-1 dashboard-card flex flex-col items-center justify-center text-center shadow-none border-none bg-transparent hover:shadow-none">
                <i class="fas fa-exclamation-triangle text-red-500 text-xl mb-1"></i>
                <span class="text-xs text-gray-500 mb-1">Urgent Cases</span>
                <span class="text-2xl font-bold text-red-600">{{ urgent_cases|default:0 }}</span>
      </div>
            <!-- Move clock/date to far right and make it bigger -->
            
        </div>
        <div class="dashboard-main-grid">
            <!-- Left Column: Requests -->
            <div class="flex flex-col h-full flex-1 gap-3">
                <div class="dashboard-card border border-gray-200 flex-1 flex flex-col p-4 mb-2 w-full" style="min-height: 180px;">
                    <h2 class="text-base font-bold text-gray-800 mb-2 flex items-center gap-2" style="font-size:1rem;"><i class="fas fa-envelope-open-text text-blue-400"></i> Pending Documentary Requests</h2>
                    <div class="overflow-x-auto flex-1" style="max-height: 260px; overflow-y: auto;">
                        <table class="min-w-full dashboard-table text-sm" style="table-layout: fixed; width: 100%;">
                            <colgroup>
                                <col style="width: 22%">
                                <col style="width: 36%">
                                <col style="width: 22%">
                                <col style="width: 20%">
                            </colgroup>
                            <thead>
                                <tr style="min-height: 48px;">
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Student</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Request Type</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Date</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for request in upcoming_requests %}
                                <tr class="hover:bg-blue-50 transition-colors {% if forloop.counter0|divisibleby:2 %}bg-gray-100{% endif %}" style="min-height: 48px;">
                                    <td class="px-2 py-2">{{ request.patient.student.firstname }} {{ request.patient.student.lastname }}</td>
                                    <td class="px-2 py-2">{{ request.request_type }}</td>
                                    <td class="px-2 py-2">{{ request.date_requested|date:"M d, Y" }}</td>
                                    <td class="px-2 py-2">
                                        <span class="px-2 py-1 text-xs font-medium rounded-full
                                            {% if not request.approve %}bg-yellow-100 text-yellow-800
                                            {% else %}bg-green-100 text-green-800{% endif %}">
                                            {% if request.approve %}Approved{% else %}Pending{% endif %}
                                        </span>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr style="min-height: 48px;">
                                    <td colspan="4" class="px-2 py-6 text-center text-gray-400">No requests found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="dashboard-card border border-gray-200 flex-1 flex flex-col p-4 mb-2 w-full" style="min-height: 180px;">
                    <h2 class="text-base font-bold text-gray-800 mb-2 flex items-center gap-2" style="font-size:1rem;"><i class="fas fa-tooth text-blue-400"></i> Pending Dental Services Request</h2>
                    <div class="overflow-x-auto flex-1" style="max-height: 260px; overflow-y: auto;">
                        <table class="min-w-full dashboard-table text-sm" style="table-layout: fixed; width: 100%;">
                            <colgroup>
                                <col style="width: 22%">
                                <col style="width: 36%">
                                <col style="width: 22%">
                                <col style="width: 20%">
                            </colgroup>
                            <thead>
                                <tr style="min-height: 48px;">
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Student</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Request Type</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Date</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for request in dental_requests %}
                                <tr class="hover:bg-blue-50 transition-colors {% if forloop.counter0|divisibleby:2 %}bg-gray-100{% endif %}" style="min-height: 48px;">
                                    <td class="px-2 py-2">{{ request.patient.student.firstname }} {{ request.patient.student.lastname }}</td>
                                    <td class="px-2 py-2">{{ request.service_type }}</td>
                                    <td class="px-2 py-2">{{ request.date_requested|date:"M d, Y" }}</td>
                                    <td class="px-2 py-2">
                                        <span class="px-2 py-1 text-xs font-medium rounded-full
                                            {% if not request.appointed %}bg-yellow-100 text-yellow-800
                                            {% else %}bg-green-100 text-green-800{% endif %}">
                                            {% if request.appointed %}Appointed{% else %}Pending{% endif %}
                                        </span>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr style="min-height: 48px;">
                                    <td colspan="4" class="px-2 py-6 text-center text-gray-400">No requests found</td>
                                </tr>
                                {% endfor %}
                                <!-- Hidden placeholder row for alignment -->
                                <tr style="visibility: hidden; height: 0;">
                                    <td>Long Name Example</td>
                                    <td>Medical Certificate for Intramurals</td>
                                    <td>May 09, 2025</td>
                                    <td>Pending</td>
                                </tr>
                            </tbody>
                        </table>
      </div>
    </div>
  </div>
            <!-- Right Column: Calendar, Schedules, History -->
            <div class="flex flex-col h-full flex-1 gap-3">
                <div class="dashboard-card border border-gray-200 flex flex-col p-2 mb-1 w-full" style="min-height: 40px; height: auto;">
                    <h2 class="text-base font-bold text-gray-800 mb-2 flex items-center gap-2" style="font-size:1.1rem;"><i class="fas fa-calendar-day text-blue-400"></i> Today's Appointments</h2>
                    <div class="overflow-x-auto flex-1" style="max-height: 260px; overflow-y: auto;">
                        <table class="min-w-full dashboard-table text-base" style="table-layout: fixed; width: 100%;">
                            <colgroup>
                                <col style="width: 35%">
                                <col style="width: 35%">
                                <col style="width: 30%">
                            </colgroup>
                            <thead>
                                <tr style="min-height: 56px;">
                                    <th class="px-2 py-3" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Student</th>
                                    <th class="px-2 py-3" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Service</th>
                                    <th class="px-2 py-3" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Time</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for appt in todays_appointments %}
                                <tr class="hover:bg-blue-50 transition-colors {% if forloop.counter0|divisibleby:2 %}bg-gray-100{% endif %}" style="min-height: 56px;">
                                    <td class="px-2 py-3">{{ appt.student }}</td>
                                    <td class="px-2 py-3">{{ appt.service }}</td>
                                    <td class="px-2 py-3">{{ appt.time }}</td>
                                </tr>
                                {% empty %}
                                <tr style="min-height: 56px;">
                                    <td colspan="3" class="px-2 py-6 text-center text-gray-400">No appointments today</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="dashboard-card border border-gray-200 flex-1 flex flex-col p-4 mb-2 w-full" style="min-height: 180px;">
                    <h2 class="text-base font-bold text-gray-800 mb-2 flex items-center gap-2" style="font-size:1rem;"><i class="fas fa-ambulance text-red-400"></i> History of Emergency Assistance</h2>
                    <div class="overflow-x-auto flex-1" style="max-height: 260px; overflow-y: auto;">
                        <table class="min-w-full dashboard-table text-sm" style="table-layout: fixed; width: 100%;">
                            <colgroup>
                                <col style="width: 22%">
                                <col style="width: 36%">
                                <col style="width: 22%">
                                <col style="width: 20%">
                            </colgroup>
                            <thead>
                                <tr style="min-height: 48px;">
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Student</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Request Type</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Date</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for request in emergency_requests %}
                                <tr class="hover:bg-blue-50 transition-colors {% if forloop.counter0|divisibleby:2 %}bg-gray-100{% endif %}" style="min-height: 48px;">
                                    <td class="px-2 py-2">{{ request.patient.student.firstname }} {{ request.patient.student.lastname }}</td>
                                    <td class="px-2 py-2">{{ request.request_type }}</td>
                                    <td class="px-2 py-2">{{ request.date_requested|date:"M d, Y" }}</td>
                                    <td class="px-2 py-2">
                                        <span class="px-2 py-1 text-xs font-medium rounded-full
                                            {% if not request.approve %}bg-yellow-100 text-yellow-800
                                            {% else %}bg-green-100 text-green-800{% endif %}">
                                            {% if request.approve %}Approved{% else %}Pending{% endif %}
                                        </span>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr style="min-height: 48px;">
                                    <td colspan="4" class="px-2 py-6 text-center text-gray-400">No records found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="dashboard-card border border-gray-200 flex-1 flex flex-col p-4 mb-2 w-full" style="min-height: 180px;">
                    <h2 class="text-base font-bold text-gray-800 mb-2 flex items-center gap-2" style="font-size:1rem;"><i class="fas fa-prescription-bottle-alt text-blue-400"></i> History of Prescriptions</h2>
                    <div class="overflow-x-auto flex-1" style="max-height: 260px; overflow-y: auto;">
                        <table class="min-w-full dashboard-table text-sm" style="table-layout: fixed; width: 100%;">
                            <colgroup>
                                <col style="width: 22%">
                                <col style="width: 36%">
                                <col style="width: 22%">
                                <col style="width: 20%">
                            </colgroup>
        <thead>
                                <tr style="min-height: 48px;">
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Student</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Request Type</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Date</th>
                                    <th class="px-2 py-2" style="position: sticky; top: 0; z-index: 2; background: #f9fafb;">Status</th>
          </tr>
        </thead>
        <tbody>
                                {% for request in prescription_requests %}
                                <tr class="hover:bg-blue-50 transition-colors {% if forloop.counter0|divisibleby:2 %}bg-gray-100{% endif %}" style="min-height: 48px;">
                                    <td class="px-2 py-2">{{ request.patient.student.firstname }} {{ request.patient.student.lastname }}</td>
                                    <td class="px-2 py-2">Prescription</td>
                                    <td class="px-2 py-2">{{ request.date_prescribed|date:"M d, Y" }}</td>
                                    <td class="px-2 py-2">
                                        <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">Completed</span>
            </td>
          </tr>
                                {% empty %}
                                <tr style="min-height: 48px;">
                                    <td colspan="4" class="px-2 py-6 text-center text-gray-400">No records found</td>
          </tr>
                                {% endfor %}
        </tbody>
      </table>
    </div>
                </div>
      </div>
        </div>
    </div>
    <!-- Quick Actions Card -->
    
</div>

<!-- Pass Django events to JS safely -->
{{ events|json_script:"admin-events-data" }}

<script>
function updateAdminLiveTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    const dateString = now.toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    document.getElementById('adminLiveTime').textContent = timeString;
    document.getElementById('adminLiveDate').textContent = dateString;
}
setInterval(updateAdminLiveTime, 1000);
document.addEventListener('DOMContentLoaded', updateAdminLiveTime);

// Parse events from Django context
const events = JSON.parse(document.getElementById('admin-events-data').textContent);

let currentDateAdmin = new Date();
const monthNamesAdmin = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
];

function updateCalendarAdmin() {
    const calendar = document.getElementById('calendarDaysAdmin');
    const monthLabel = document.getElementById('currentMonthAdmin');
    calendar.innerHTML = '';
    monthLabel.textContent = `${monthNamesAdmin[currentDateAdmin.getMonth()]} ${currentDateAdmin.getFullYear()}`;
    const firstDay = new Date(currentDateAdmin.getFullYear(), currentDateAdmin.getMonth(), 1);
    const startingDay = firstDay.getDay();
    const lastDay = new Date(currentDateAdmin.getFullYear(), currentDateAdmin.getMonth() + 1, 0);
    const totalDays = lastDay.getDate();

    // Add empty cells for days before the first day of the month
    for (let i = 0; i < startingDay; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-day-admin empty-day';
        calendar.appendChild(emptyCell);
    }

    // Add the days of the month
    for (let day = 1; day <= totalDays; day++) {
        const cell = document.createElement('div');
        cell.className = 'calendar-day-admin';
        
        // Create date string for comparison
        const dateString = `${currentDateAdmin.getFullYear()}-${String(currentDateAdmin.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        
        // Check for events on this day
        const dayEvents = events.filter(event => event.date === dateString);
        if (dayEvents.length > 0) {
            const hasApproved = dayEvents.some(event => event.status === 'approved');
            const hasPending = dayEvents.some(event => event.status === 'pending');
            
            if (hasApproved && hasPending) {
                cell.className += ' has-both-events';
            } else if (hasApproved) {
                cell.className += ' has-approved-event';
            } else if (hasPending) {
                cell.className += ' has-pending-event';
            }
        }

        // Highlight current day
        const today = new Date();
        if (day === today.getDate() &&
            currentDateAdmin.getMonth() === today.getMonth() &&
            currentDateAdmin.getFullYear() === today.getFullYear()) {
            cell.className += ' today';
        }

        cell.textContent = day;
        calendar.appendChild(cell);
    }

    // Add empty cells for remaining days to complete the grid
    const remainingDays = 42 - (startingDay + totalDays);
    for (let i = 0; i < remainingDays; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-day-admin empty-day';
        calendar.appendChild(emptyCell);
    }
}
function previousMonthAdmin() {
    currentDateAdmin.setMonth(currentDateAdmin.getMonth() - 1);
    updateCalendarAdmin();
}
function nextMonthAdmin() {
    currentDateAdmin.setMonth(currentDateAdmin.getMonth() + 1);
    updateCalendarAdmin();
}
document.addEventListener('DOMContentLoaded', updateCalendarAdmin);
</script>
{% endblock %}
