{% extends 'mainv2.html' %}
{% load static tailwind_tags %}

{% block title %} HealthHub Connect | Student Dashboard {% endblock %}

{% block extra_css %} 
{% tailwind_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
    .tab-button.active {
        background-color: #3B82F6;
        color: white;
    }
    .tab-content {
        display: none;
    }
    .tab-content.active {
        display: block;
    }
    .profile-icon {
        font-size: 4rem;
        width: 8rem;
        height: 8rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #E5F2FF;
        color: #3B82F6;
        border-radius: 9999px;
    }
    /* Hide scrollbar but maintain functionality */
    .custom-scrollbar {
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */
    }
    .custom-scrollbar::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
    }
    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: rgba(156, 163, 175, 0.5);
        border-radius: 3px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background-color: rgba(156, 163, 175, 0.7);
    }
    /* Ensure content area is scrollable */
    .content-area {
        height: calc(100vh - 4rem); /* Adjust based on your header height */
        overflow-y: auto;
    }
    /* Add smooth transition for tab changes */
    .tab-content {
        transition: opacity 0.2s ease-in-out;
    }
    .tab-content:not(.active) {
        display: none;
        opacity: 0;
    }
    .tab-content.active {
        display: block;
        opacity: 1;
    }
    /* Fix for sticky header and scrollable content */
    .sticky {
        position: sticky;
        top: 0;
        z-index: 10;
        background: white;
    }
    /* Ensure content fills available space */
    .tab-content > div {
        min-height: 100%;
    }
    .calendar-grid {
        background-color: white;
        border-radius: 0.5rem;
        padding: 1rem;
    }
    .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 2px;
        margin-bottom: 0.5rem;
    }
    .calendar-header-cell {
        text-align: center;
        font-size: 0.75rem;
        font-weight: 500;
        color: #6B7280;
        padding: 0.5rem 0;
    }
    #calendarDays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 2px;
    }
    .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.875rem;
        color: #374151;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    .calendar-day:hover:not(.empty-day) {
        background-color: #E5F2FF;
    }
    .calendar-day.today {
        background-color: #3B82F6;
        color: white;
    }
    .calendar-day.empty-day {
        cursor: default;
        color: #D1D5DB;
    }
</style>
{% endblock %}

{% block content %}
<div class="w-full h-full flex items-center justify-center">
    <div class="w-[1100px] bg-white rounded-[24px] shadow-lg overflow-hidden flex">
    {% if patient %}
        <!-- Left: Profile Section -->
        <div class="w-[260px] p-6 bg-white border-r flex flex-col items-center text-center">
            <div class="profile-icon mb-6">
                <i class="fas fa-user-circle"></i>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">{{ student.firstname }} {{ student.middlename }} {{ student.lastname }}</h2>
            <p class="text-gray-600 mb-2">Student ID: {{ student.student_id }}</p>
            <p class="text-gray-600">{{ student.degree }}</p>
            <p class="text-gray-600 mb-4">Year {{ student.year_level }}</p>
            <button id="editProfileBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">Edit Profile</button>

            <!-- Edit Profile Modal -->
            <div id="editProfileModal" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
                <div class="bg-white rounded-lg p-8 w-[350px] shadow-xl relative">
                    <button id="closeEditProfile" class="absolute top-2 right-2 text-gray-400 hover:text-gray-700">&times;</button>
                    <h3 class="text-lg font-bold mb-4">Edit Profile (Mockup)</h3>
                    <form>
                        <div class="mb-2">
                            <label class="block text-sm font-medium">First Name</label>
                            <input type="text" class="w-full border rounded px-2 py-1" value="{{ student.firstname }}" />
                        </div>
                        <div class="mb-2">
                            <label class="block text-sm font-medium">Middle Name</label>
                            <input type="text" class="w-full border rounded px-2 py-1" value="{{ student.middlename }}" />
                        </div>
                        <div class="mb-2">
                            <label class="block text-sm font-medium">Last Name</label>
                            <input type="text" class="w-full border rounded px-2 py-1" value="{{ student.lastname }}" />
                        </div>
                        <div class="mb-2">
                            <label class="block text-sm font-medium">Degree</label>
                            <input type="text" class="w-full border rounded px-2 py-1" value="{{ student.degree }}" />
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium">Year Level</label>
                            <input type="text" class="w-full border rounded px-2 py-1" value="{{ student.year_level }}" />
                        </div>
                        <button type="button" class="w-full bg-blue-500 text-white rounded py-2 font-semibold">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- Center: Tabbed Information -->
        <div class="flex-1 h-full flex flex-col overflow-x-auto p-8">
            <div class="border-b sticky top-0 bg-white z-10 mb-4">
                <div class="flex overflow-x-auto">
                    <button class="tab-button active px-6 py-3 text-sm font-medium" data-tab="general">General Information</button>
                    <button class="tab-button px-6 py-3 text-sm font-medium" data-tab="medical">Medical Information</button>
                    <button class="tab-button px-6 py-3 text-sm font-medium" data-tab="history">Medical History</button>
                    <button class="tab-button px-6 py-3 text-sm font-medium" data-tab="contact">Contact Information</button>
                </div>
            </div>
            <div class="overflow-y-auto custom-scrollbar flex-1">
                <div class="p-2">
                    <!-- General Information Tab -->
                    <div class="tab-content active" id="general-tab">
                        <div class="grid grid-cols-1 gap-4">
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Sex</h3>
                                <p class="text-gray-900">{{ student.sex }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Age</h3>
                                <p class="text-gray-900">{{ patient.age }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Birth Date</h3>
                                <p class="text-gray-900">{{ patient.birth_date }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Civil Status</h3>
                                <p class="text-gray-900">{{ patient.civil_status }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Nationality</h3>
                                <p class="text-gray-900">{{ patient.nationality }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Religion</h3>
                                <p class="text-gray-900">{{ patient.religion }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Medical Information Tab -->
                    <div class="tab-content" id="medical-tab">
                        <div class="grid grid-cols-1 gap-4">
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Blood Type</h3>
                                <p class="text-gray-900">{{ patient.bloodtype }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Height</h3>
                                <p class="text-gray-900">{{ patient.height }} cm</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Weight</h3>
                                <p class="text-gray-900">{{ patient.weight }} kg</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Blood Pressure</h3>
                                <p class="text-gray-900">{{ patient.blood_pressure|default:"Not recorded" }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Allergies</h3>
                                <p class="text-gray-900">{{ patient.allergies|default:"None" }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Current Medications</h3>
                                <p class="text-gray-900">{{ patient.medications|default:"None" }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Medical History Tab -->
                    <div class="tab-content" id="history-tab">
                        <div class="grid grid-cols-1 gap-4">
                            {% if medical_history.no_history %}
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Medical History</h3>
                                <p class="text-gray-900">No medical history reported</p>
                            </div>
                            {% else %}
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Medical Conditions</h3>
                                <div class="grid grid-cols-2 gap-2">
                                    {% if medical_history.tuberculosis %}
                                    <p class="text-gray-900">• Tuberculosis</p>
                                    {% endif %}
                                    {% if medical_history.hypertension %}
                                    <p class="text-gray-900">• Hypertension</p>
                                    {% endif %}
                                    {% if medical_history.heart_disease %}
                                    <p class="text-gray-900">• Heart Disease</p>
                                    {% endif %}
                                    {% if medical_history.hernia %}
                                    <p class="text-gray-900">• Hernia</p>
                                    {% endif %}
                                    {% if medical_history.epilepsy %}
                                    <p class="text-gray-900">• Epilepsy</p>
                                    {% endif %}
                                    {% if medical_history.peptic_ulcer %}
                                    <p class="text-gray-900">• Peptic Ulcer</p>
                                    {% endif %}
                                    {% if medical_history.kidney_disease %}
                                    <p class="text-gray-900">• Kidney Disease</p>
                                    {% endif %}
                                    {% if medical_history.asthma %}
                                    <p class="text-gray-900">• Asthma</p>
                                    {% endif %}
                                    {% if medical_history.insomnia %}
                                    <p class="text-gray-900">• Insomnia</p>
                                    {% endif %}
                                    {% if medical_history.malaria %}
                                    <p class="text-gray-900">• Malaria</p>
                                    {% endif %}
                                    {% if medical_history.venereal_disease %}
                                    <p class="text-gray-900">• Venereal Disease</p>
                                    {% endif %}
                                    {% if medical_history.nervous_breakdown %}
                                    <p class="text-gray-900">• Nervous Breakdown</p>
                                    {% endif %}
                                    {% if medical_history.jaundice %}
                                    <p class="text-gray-900">• Jaundice</p>
                                    {% endif %}
                                    {% if medical_history.others %}
                                    <p class="text-gray-900">• {{ medical_history.others }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Family Medical History</h3>
                                {% if family_history.no_history %}
                                <p class="text-gray-900">No family medical history reported</p>
                                {% else %}
                                <div class="grid grid-cols-2 gap-2">
                                    {% if family_history.hypertension %}
                                    <p class="text-gray-900">• Hypertension</p>
                                    {% endif %}
                                    {% if family_history.asthma %}
                                    <p class="text-gray-900">• Asthma</p>
                                    {% endif %}
                                    {% if family_history.cancer %}
                                    <p class="text-gray-900">• Cancer</p>
                                    {% endif %}
                                    {% if family_history.tuberculosis %}
                                    <p class="text-gray-900">• Tuberculosis</p>
                                    {% endif %}
                                    {% if family_history.diabetes %}
                                    <p class="text-gray-900">• Diabetes</p>
                                    {% endif %}
                                    {% if family_history.bleeding_disorder %}
                                    <p class="text-gray-900">• Bleeding Disorder</p>
                                    {% endif %}
                                    {% if family_history.epilepsy %}
                                    <p class="text-gray-900">• Epilepsy</p>
                                    {% endif %}
                                    {% if family_history.mental_disorder %}
                                    <p class="text-gray-900">• Mental Disorder</p>
                                    {% endif %}
                                    {% if family_history.other_medical_history %}
                                    <p class="text-gray-900">• {{ family_history.other_medical_history }}</p>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <!-- Contact Information Tab -->
                    <div class="tab-content" id="contact-tab">
                        <div class="grid grid-cols-1 gap-4">
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Home Address</h3>
                                <p class="text-gray-900">{{ patient.home_address }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">City</h3>
                                <p class="text-gray-900">{{ patient.city }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Province</h3>
                                <p class="text-gray-900">{{ patient.state_province }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Postal Code</h3>
                                <p class="text-gray-900">{{ patient.postal_zipcode }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Emergency Contact</h3>
                                <p class="text-gray-900">{{ patient.parent_guardian }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-gray-700 mb-2">Emergency Contact Number</h3>
                                <p class="text-gray-900">{{ patient.parent_guardian_contact_number }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Right: Requests Tracker -->
        <div class="w-[260px] p-6 bg-gray-50 border-l flex flex-col">
            <h2 class="text-lg font-bold text-gray-800 mb-4">My Requests</h2>
            <div class="flex-1 overflow-y-auto rounded-lg mb-6">
                <table class="min-w-full divide-y divide-gray-200 text-sm">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="px-3 py-2 text-left font-semibold text-gray-600 uppercase tracking-wider">Type</th>
                            <th class="px-3 py-2 text-left font-semibold text-gray-600 uppercase tracking-wider">Date</th>
                            <th class="px-3 py-2 text-left font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for request in patient_requests %}
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="px-3 py-2">{{ request.request_type }}</td>
                            <td class="px-3 py-2">{{ request.date_requested|date:"M d, Y" }}</td>
                            <td class="px-3 py-2">
                                {% if request.approve %}
                                    <span class="inline-block px-2 py-1 rounded bg-green-100 text-green-800">Approved</span>
                                {% else %}
                                    <span class="inline-block px-2 py-1 rounded bg-yellow-100 text-yellow-800">Pending</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="3" class="px-3 py-8 text-center text-gray-400">No requests found</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="bg-white rounded-lg p-8 shadow-sm w-full max-w-[420px] h-[420px] mx-auto flex flex-col">
                <div class="text-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800" id="currentMonthYear"></h3>
                    <p class="text-sm text-blue-600 font-medium" id="currentDate"></p>
                </div>
                <div class="calendar-grid h-full flex-1 flex flex-col justify-between">
                    <div class="calendar-header">
                        <div class="calendar-header-cell">Su</div>
                        <div class="calendar-header-cell">Mo</div>
                        <div class="calendar-header-cell">Tu</div>
                        <div class="calendar-header-cell">We</div>
                        <div class="calendar-header-cell">Th</div>
                        <div class="calendar-header-cell">Fr</div>
                        <div class="calendar-header-cell">Sa</div>
                    </div>
                    <div id="calendarDays" class="flex-1 grid grid-cols-7 grid-rows-6 gap-1"></div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="bg-white rounded-lg shadow-lg p-6 text-center w-full flex items-center justify-center">
            <div>
                <p class="text-gray-600 mb-4">No medical records found. Please complete your medical form.</p>
                <a href="{% url 'main:patient_form' %}" class="inline-block px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">Complete Medical Form</a>
            </div>
        </div>
    {% endif %}
    </div>
</div>

{% block extra_js %}
<script>
// Edit Profile Modal Logic
const editBtn = document.getElementById('editProfileBtn');
const modal = document.getElementById('editProfileModal');
const closeModal = document.getElementById('closeEditProfile');
if (editBtn && modal && closeModal) {
    editBtn.onclick = () => modal.classList.remove('hidden');
    closeModal.onclick = () => modal.classList.add('hidden');
    window.onclick = (e) => {
        if (e.target === modal) modal.classList.add('hidden');
    };
}

// Tab Switching Logic
document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            // Remove active class from all buttons and contents
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            // Add active class to clicked button
            button.classList.add('active');

            // Show corresponding content
            const tabId = button.getAttribute('data-tab');
            const content = document.getElementById(`${tabId}-tab`);
            if (content) {
                content.classList.add('active');
            }
        });
    });

    // Calendar Logic
    const today = new Date();
    const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
    ];
    const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

    // Update current date display
    document.getElementById('currentMonthYear').textContent = `${monthNames[today.getMonth()]} ${today.getFullYear()}`;
    document.getElementById('currentDate').textContent = 
        `${dayNames[today.getDay()]}, ${monthNames[today.getMonth()]} ${today.getDate()}`;

    // Generate calendar days
    const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
    const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
    const calendarDays = document.getElementById('calendarDays');
    
    // Add empty cells for days before the first day of the month
    for (let i = 0; i < firstDay.getDay(); i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day empty-day';
        calendarDays.appendChild(emptyDay);
    }

    // Add the days of the month
    for (let day = 1; day <= lastDay.getDate(); day++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        
        // Highlight current day
        if (day === today.getDate()) {
            dayElement.className += ' today';
        }
        
        dayElement.textContent = day;
        calendarDays.appendChild(dayElement);
    }

    // Add empty cells for remaining days to complete the grid
    const remainingDays = 42 - (firstDay.getDay() + lastDay.getDate()); // 42 = 6 rows × 7 days
    for (let i = 0; i < remainingDays; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day empty-day';
        calendarDays.appendChild(emptyDay);
    }
});
</script>
{% endblock %}
{% endblock %}