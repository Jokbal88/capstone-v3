{% extends 'mainv2.html' %}
{% load static tailwind_tags %}

{% block title %}Medical Clearance{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" media="print" href="{% static 'styles/print.css' %}">
{% endblock %}

{% block content %}
<div class="w-full h-screen rounded-[14px] bg-white xs:p-4 md:p-8 flex flex-col gap-4">
    {% comment %}
    {% if messages %}
        {% for message in messages %}
            <div class="{{ message.tags }} p-2 rounded-md">{{ message }}</div>
        {% endfor %}
    {% endif %}
    {% endcomment %}
    <form action="" method="POST" id="medicalclearance-form">
        {% csrf_token %}
         <div class="flex items-center self-center gap-4">
            <img class="size-[8rem]" src="{% static 'images/CTU_logo.png' %}" alt="CTU_logo">
            <div class="flex flex-col items-center">
                <div class="content1">REPUBLIC OF THE PHILIPPINES</div>
                <div class="content2">CEBU TECHNOLOGICAL UNIVERSITY</div>
                <div class="content3">ARGAO CAMPUS</div>
                <div class="content4">Ed Kintanar Street, Lamacan, Argao, Cebu</div>
                <div class="content4">Website: https://www.argao.ctu.edu.ph E-mail: cdargao@ctu.edu.ph</div>
                <div class="content4">Phone No.:(032) 401-0737 local 1700</div>
            </div>
            <img class="size-[8rem]" src="{% static 'images/BP_logo.png' %}" alt="BP_logo">
        </div>
        <div class="flex flex-col">
            <h1 class="text-center font-bold text-[1.3rem] py-4">MEDICAL CLINIC</h1>
            <h2 class="text-center font-bold text-[1rem] mb-4">Medical Clearance for OJT/Practicum</h2>

            <fieldset class="flex flex-col gap-2 py-4">
                <legend class="text-lg font-medium mb-2">I. Information</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex flex-col">
                        <label for="student_id" class="text-sm font-medium text-gray-700">Student ID:</label>
                        <input type="text" name="student_id" id="student_id" value="{{ student.student_id|default_if_none:'' }}" readonly class="mt-1 p-2 border rounded-md bg-gray-100">
                    </div>
                     <div class="flex flex-col">
                        <label for="surname" class="text-sm font-medium text-gray-700">Surname:</label>
                        <input type="text" name="surname" id="surname" value="{{ student.lastname|default_if_none:'' }}" readonly class="mt-1 p-2 border rounded-md bg-gray-100">
                    </div>
                     <div class="flex flex-col">
                        <label for="first_name" class="text-sm font-medium text-gray-700">First Name:</label>
                        <input type="text" name="first_name" id="first_name" value="{{ student.firstname|default_if_none:'' }}" readonly class="mt-1 p-2 border rounded-md bg-gray-100">
                    </div>
                    <div class="flex flex-col">
                        <label for="middle_name" class="text-sm font-medium text-gray-700">Middle Name:</label>
                        <input type="text" name="middle_name" id="middle_name" value="{{ student.middlename|default_if_none:'' }}" readonly class="mt-1 p-2 border rounded-md bg-gray-100">
                    </div>
                    <div class="flex flex-col">
                        <label for="age" class="text-sm font-medium text-gray-700">Age:</label>
                        <input type="number" name="age" id="age" value="{{ patient.age|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Enter Age">
                    </div>
                    <div class="flex flex-col">
                        <label for="sex" class="text-sm font-medium text-gray-700">Sex:</label>
                        <input type="text" name="sex" id="sex" value="{{ student.sex|default_if_none:'' }}" readonly class="mt-1 p-2 border rounded-md bg-gray-100">
                    </div>
                    <div class="flex flex-col">
                        <label for="contact_number" class="text-sm font-medium text-gray-700">Contact Number:</label>
                        <input type="text" name="contact_number" id="contact_number" value="{{ student.contact_number|default_if_none:'' }}" readonly class="mt-1 p-2 border rounded-md bg-gray-100">
                    </div>
                    <div class="flex flex-col">
                        <label for="email_address" class="text-sm font-medium text-gray-700">Email Address:</label>
                        <input type="email" name="email_address" id="email_address" value="{{ student.email|default_if_none:'' }}" readonly class="mt-1 p-2 border rounded-md bg-gray-100">
                    </div>
                    <div class="flex flex-col">
                        <label for="birth_date" class="text-sm font-medium text-gray-700">Birth Date:</label>
                        <input type="date" name="birth-date" id="birth_date" value="{{ patient.birth_date|date:'Y-m-d'|default_if_none:'' }}" class="mt-1 p-2 border rounded-md">
                    </div>
                     <div class="flex flex-col">
                        <label for="street_address" class="text-sm font-medium text-gray-700">Address:</label>
                        <input type="text" name="street-address" id="street_address" value="{{ patient.home_address|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Enter Street Address">
                    </div>
                     <div class="flex flex-col">
                        <label for="city" class="text-sm font-medium text-gray-700">City:</label>
                        <input type="text" name="city" id="city" value="{{ patient.city|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Enter City">
                    </div>
                     <div class="flex flex-col">
                        <label for="state_province" class="text-sm font-medium text-gray-700">State/Province:</label>
                        <input type="text" name="state-province" id="state_province" value="{{ patient.state_province|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Enter State/Province">
                    </div>
                    <div class="flex flex-col">
                        <label for="postal_zip_code" class="text-sm font-medium text-gray-700">Postal/Zip Code:</label>
                        <input type="text" name="postal-zip-code" id="postal_zip_code" value="{{ patient.postal_zipcode|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Enter Postal/Zip Code">
                    </div>
                    <div class="flex flex-col">
                        <label for="country" class="text-sm font-medium text-gray-700">Country:</label>
                        <input type="text" name="country" id="country" value="{{ patient.country|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Enter Country">
                    </div>
                </div>
            </fieldset>

            <fieldset class="flex flex-col gap-4 py-4">
                 <legend class="text-lg font-medium mb-2">II. Risk Assessment</legend>
                 <p>Do you have any of these?</p>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                     <div class="flex flex-col gap-2">
                        <label>Age above 60 years old</label>
                        <label>Cardiovascular Disease/Hypertension</label>
                        <label>Chronic Lung Disease/Asthma</label>
                        <label>Chronic Metabolic Disease/Diabetes</label>
                        <label>Chronic Renal Disease</label>
                        <label>Chronic Liver Disease</label>
                        <label>Cancer</label>
                        <label>Autoimmune Disease, Immunodeficient State (HIV & Others)</label>
                        <label>Pregnant, AOG</label>
                        <label>Living with person belonging to vulnerable population</label>
                        <label for="pwd">Person with Disability (PWD)</label>
                     </div>
                     <div class="flex flex-col gap-2">
                         <div class="flex justify-around">
                            <span>Yes</span>
                            <span>No</span>
                         </div>
                         <div class="flex justify-around">
                             <input type="radio" name="age_above_60" value="True" {% if clearance.riskassessment.age_above_60 %}checked{% endif %}> 
                             <input type="radio" name="age_above_60" value="False" {% if clearance.riskassessment.age_above_60 is False %}checked{% endif %}>
                         </div>
                          <div class="flex justify-around">
                             <input type="radio" name="cardiovascular-disease" value="True" {% if clearance.riskassessment.cardiovascular_disease %}checked{% endif %}>
                             <input type="radio" name="cardiovascular-disease" value="False" {% if clearance.riskassessment.cardiovascular_disease is False %}checked{% endif %}>
                         </div>
                          <div class="flex justify-around">
                             <input type="radio" name="lung-disease" value="True" {% if clearance.riskassessment.chronic_lung_disease %}checked{% endif %}>
                             <input type="radio" name="lung-disease" value="False" {% if clearance.riskassessment.chronic_lung_disease is False %}checked{% endif %}>
                         </div>
                          <div class="flex justify-around">
                             <input type="radio" name="diabetes" value="True" {% if clearance.riskassessment.chronic_metabolic_disease %}checked{% endif %}>
                             <input type="radio" name="diabetes" value="False" {% if clearance.riskassessment.chronic_metabolic_disease is False %}checked{% endif %}>
                         </div>
                          <div class="flex justify-around">
                             <input type="radio" name="renal-disease" value="True" {% if clearance.riskassessment.chronic_renal_disease %}checked{% endif %}>
                             <input type="radio" name="renal-disease" value="False" {% if clearance.riskassessment.chronic_renal_disease is False %}checked{% endif %}>
                         </div>
                          <div class="flex justify-around">
                             <input type="radio" name="liver-disease" value="True" {% if clearance.riskassessment.chronic_liver_disease %}checked{% endif %}>
                             <input type="radio" name="liver-disease" value="False" {% if clearance.riskassessment.chronic_liver_disease is False %}checked{% endif %}>
                         </div>
                          <div class="flex justify-around">
                             <input type="radio" name="cancer" value="True" {% if clearance.riskassessment.cancer %}checked{% endif %}>
                             <input type="radio" name="cancer" value="False" {% if clearance.riskassessment.cancer is False %}checked{% endif %}>
                         </div>
                          <div class="flex justify-around">
                             <input type="radio" name="autoimmune" value="True" {% if clearance.riskassessment.autoimmune_disease %}checked{% endif %}>
                             <input type="radio" name="autoimmune" value="False" {% if clearance.riskassessment.autoimmune_disease is False %}checked{% endif %}>
                         </div>
                          <div class="flex justify-around">
                             <input type="radio" name="pregnant" value="True" {% if clearance.riskassessment.pregnant %}checked{% endif %}>
                             <input type="radio" name="pregnant" value="False" {% if clearance.riskassessment.pregnant is False %}checked{% endif %}>
                         </div>
                          <div class="flex justify-around">
                             <input type="radio" name="living_with_vulnerable" value="True" {% if clearance.riskassessment.living_with_vulnerable %}checked{% endif %}>
                             <input type="radio" name="living_with_vulnerable" value="False" {% if clearance.riskassessment.living_with_vulnerable is False %}checked{% endif %}>
                         </div>
                         <div class="flex justify-around">
                             <input type="radio" name="pwd" value="True" id="pwd" {% if clearance.riskassessment.pwd %}checked{% endif %}>
                             <input type="radio" name="pwd" value="False" {% if clearance.riskassessment.pwd is False %}checked{% endif %}>
                         </div>
                     </div>
                 </div>
                 <div class="flex flex-col w-full mt-4">
                    <label for="other_conditions" class="text-sm font-medium text-gray-700">Specify other conditions not listed ab:</label>
                    <input type="text" name="other_conditions" id="other_conditions" value="{{ clearance.riskassessment.other_conditions|default_if_none:'' }}" class="mt-1 p-2 border rounded-md">
                 </div>
                 <div class="flex flex-col w-full mt-4">
                    <label for="disability_type" class="text-sm font-medium text-gray-700">If you are a PWD, please provide the following details:</label>
                    <input type="text" name="disability_type" id="disability_type" value="{{ clearance.riskassessment.disability|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Type of Disability">
                 </div>
                  <p class="mt-4 text-sm text-gray-600">
                      If you answered yes to any of the above, you are advised against joining face-to-face activities and should opt for online mode of class/OJT/Practicum due
                      to the health risk during the COVID-19 pandemic. Insistence in joining face-to-face school activity will only be allowed upon the presentation of a medical
                      certificate from an attending physician, indicating the condition is stable and the patient is fit to physically attend class/OJT/Practicum. Student personnel will
                      be responsible for acting against medical advice.
                 </p>
            </fieldset>

            <fieldset class="flex flex-col gap-4 py-4">
                <legend class="text-lg font-medium mb-2">III. Medical Requirements</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex flex-col gap-2">
                         <p class="font-medium">Medical Requirement</p>
                         <label>Covid-19 Vaccination</label>
                         <label>Chest X-ray (PA view)</label>
                         <label>Complete Blood Count</label>
                         <label>Drug Test (from DOH Accredited Laboratory)</label>
                         <label>Stool Examination</label>
                          <label>PWD Card</label>
                    </div>
                    <div class="flex flex-col gap-2">
                        <p class="font-medium">Status</p>
                        <select name="vaccination_type" class="mt-1 p-2 border rounded-md">
                            <option value="">Select Vaccination Type</option>
                            <option value="Pfizer" {% if med_requirements.vaccination_type == 'Pfizer' %}selected{% endif %}>Pfizer</option>
                            <option value="Moderna" {% if med_requirements.vaccination_type == 'Moderna' %}selected{% endif %}>Moderna</option>
                            <option value="AstraZeneca" {% if med_requirements.vaccination_type == 'AstraZeneca' %}selected{% endif %}>AstraZeneca</option>
                            <option value="Sinovac" {% if med_requirements.vaccination_type == 'Sinovac' %}selected{% endif %}>Sinovac</option>
                            <option value="Johnson & Johnson" {% if med_requirements.vaccination_type == 'Johnson & Johnson' %}selected{% endif %}>Johnson & Johnson</option>
                            <option value="Sputnik V" {% if med_requirements.vaccination_type == 'Sputnik V' %}selected{% endif %}>Sputnik V</option>
                            <option value="Covaxin" {% if med_requirements.vaccination_type == 'Covaxin' %}selected{% endif %}>Covaxin</option>
                             <option value="Novavax" {% if med_requirements.vaccination_type == 'Novavax' %}selected{% endif %}>Novavax</option>
                             <option value="Other" {% if med_requirements.vaccination_type == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                         <input type="text" name="x-ray-remark" value="{{ med_requirements.x_ray_remarks|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Enter Remarks">
                         <input type="text" name="cbc-remark" value="{{ med_requirements.cbc_remarks|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Enter Remarks">
                         <input type="text" name="drug-test-remark" value="{{ med_requirements.drug_test_remarks|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Enter Remarks">
                         <input type="text" name="stool-examination-remark" value="{{ med_requirements.stool_examination_remarks|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Enter Remarks">
                          <input type="text" name="pwd-card-remark" value="{{ med_requirements.pwd_card_remarks|default_if_none:'' }}" class="mt-1 p-2 border rounded-md" placeholder="Enter Remarks">
                    </div>
                </div>
                <div class="flex items-center gap-4 mt-4">
                    <span>Covid-19 Vaccination Doses Received:</span>
                     <label><input type="checkbox" name="vaccinated_1st" {% if med_requirements.vaccinated_1st %}checked{% endif %}> 1st Dose</label>
                     <label><input type="checkbox" name="vaccinated_2nd" {% if med_requirements.vaccinated_2nd %}checked{% endif %}> 2nd Dose</label>
                     <label><input type="checkbox" name="vaccinated_booster" {% if med_requirements.vaccinated_booster %}checked{% endif %}> Booster Shot</label>
                </div>
            </fieldset>
             {# Section IV: Certification - Assuming this is static text or information not directly linked to savable fields #}
             {# Add this section if needed based on the second image #}
            <fieldset class="flex flex-col gap-4 py-4">
                <legend class="text-lg font-medium mb-2">IV. Certification</legend>
                <p class="text-justify">
                    This is to certify that the above information is true and correct to the best of my knowledge and belief.
                    I understand that any false information may result in the denial of my medical clearance.
                </p>
                {# Add fields for signatures if they are part of the form submission #}
                {# For now, assuming they are part of a printout/visual element #}
            </fieldset>
        </div>
        
        <div class="flex justify-between w-full mt-4">
            <div class="flex">
                <a class="border border-yellow-400 rounded-md p-2" href="{% url 'medical:viewrequest' %}">Back</a>
            </div>
            <div class="flex gap-1">
                <input class="bg-blue-500 text-white rounded-md p-2" type="submit" value="Save">
                 {# Add a print button if needed #}
                 <input class="bg-yellow-400 text-white rounded-md p-2" type="button" value="Print" onclick="window.print()">
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('medicalclearance-form');

        const pwdRadioButtons = document.getElementsByName('pwd');
        const pwdDetailsSection = document.getElementById('pwd-details');

        // Initial state based on loaded data
        if (document.querySelector('input[name="pwd"]:checked') && document.querySelector('input[name="pwd"]:checked').value === 'True') {
            pwdDetailsSection.style.display = 'block';
        } else {
            pwdDetailsSection.style.display = 'none';
        }

        pwdRadioButtons.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'True') {
                    pwdDetailsSection.style.display = 'block';
                } else {
                    pwdDetailsSection.style.display = 'none';
                }
            });
        });
    });
    function printSpecificContent() {
        const printContent = document.getElementById('medicalclearance-form').innerHTML;
        const originalContent = document.body.innerHTML;

        document.body.innerHTML = printContent;
        window.print();
        document.body.innerHTML = originalContent;
        location.reload(true); // Reload to restore original page content
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const messagesJson = '{{ messages_json|escapejs }}';
        const messages = JSON.parse(messagesJson);

        messages.forEach(function(message) {
            Swal.fire({
                icon: message.tags,
                title: 'Notification',
                text: message.text,
                confirmButtonText: 'OK'
            });
        });
    });
</script>
{% endblock %}